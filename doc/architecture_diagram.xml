<mxfile host="app.diagrams.net" modified="2026-02-13T04:35:00.000Z" agent="ChatServer Architecture" version="24.0.0" type="device">
  <diagram id="chatserver-arch" name="ChatServer å¾®æœåŠ¡æž¶æž„">
    <mxGraphModel dx="1800" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- ==================== æ ‡é¢˜ ==================== -->
        <mxCell id="title" value="&lt;b&gt;ChatServer å¾®æœåŠ¡æž¶æž„å›¾&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=22;fontColor=#1a1a2e;" vertex="1" parent="1">
          <mxGeometry x="580" y="20" width="340" height="40" as="geometry"/>
        </mxCell>

        <!-- ==================== å®¢æˆ·ç«¯å±‚ ==================== -->
        <mxCell id="client-group" value="å®¢æˆ·ç«¯ (Client)" style="swimlane;startSize=28;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=13;fontColor=#333333;rounded=1;arcSize=8;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="530" y="80" width="440" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="web" value="Web / Vue" style="shape=mxgraph.basic.layered_rect;dx=10;dy=10;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1;shadow=1;rounded=1;" vertex="1" parent="client-group">
          <mxGeometry x="20" y="35" width="120" height="35" as="geometry"/>
        </mxCell>
        <mxCell id="mobile" value="iOS / Android" style="shape=mxgraph.basic.layered_rect;dx=10;dy=10;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1;shadow=1;rounded=1;" vertex="1" parent="client-group">
          <mxGeometry x="160" y="35" width="120" height="35" as="geometry"/>
        </mxCell>
        <mxCell id="desktop" value="Desktop / Electron" style="shape=mxgraph.basic.layered_rect;dx=10;dy=10;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1;shadow=1;rounded=1;" vertex="1" parent="client-group">
          <mxGeometry x="300" y="35" width="120" height="35" as="geometry"/>
        </mxCell>

        <!-- ==================== æŽ¥å…¥å±‚ ==================== -->
        <mxCell id="access-group" value="æŽ¥å…¥å±‚ (Access Layer)" style="swimlane;startSize=28;fillColor=#e1f5fe;strokeColor=#0288d1;fontStyle=1;fontSize=13;fontColor=#01579b;rounded=1;arcSize=8;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="220" width="940" height="155" as="geometry"/>
        </mxCell>

        <!-- Gateway -->
        <mxCell id="gateway" value="&lt;b&gt;Gateway ç½‘å…³&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px;color:#555'&gt;apps/gateway&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;shadow=1;arcSize=12;" vertex="1" parent="access-group">
          <mxGeometry x="30" y="35" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="gw-gin" value="Gin Engine&lt;br&gt;HTTP :8080" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fffde7;strokeColor=#f9a825;fontSize=10;arcSize=15;" vertex="1" parent="access-group">
          <mxGeometry x="30" y="95" width="85" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="gw-mw" value="Middleware&lt;br&gt;&lt;font style='font-size:8px'&gt;JWT / CORS / RateLimit&lt;br&gt;Recovery / Prometheus&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fffde7;strokeColor=#f9a825;fontSize=10;arcSize=15;" vertex="1" parent="access-group">
          <mxGeometry x="125" y="95" width="130" height="45" as="geometry"/>
        </mxCell>

        <!-- Gateway è·¯ç”±è¯¦æƒ… -->
        <mxCell id="gw-routes" value="&lt;b&gt;API Routes&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#555'&gt;/api/v1/public/user/*&lt;br&gt;/api/v1/auth/user/*&lt;br&gt;/api/v1/auth/friend/*&lt;br&gt;/api/v1/auth/blacklist/*&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#f9a825;fontSize=10;arcSize=10;" vertex="1" parent="access-group">
          <mxGeometry x="280" y="40" width="160" height="100" as="geometry"/>
        </mxCell>

        <!-- Connect -->
        <mxCell id="connect" value="&lt;b&gt;Connect æŽ¥å…¥&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px;color:#555'&gt;apps/connect&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#43a047;fontSize=12;shadow=1;arcSize=12;" vertex="1" parent="access-group">
          <mxGeometry x="490" y="35" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="conn-ws" value="WebSocket&lt;br&gt;HTTP :8081" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#66bb6a;fontSize=10;arcSize=15;" vertex="1" parent="access-group">
          <mxGeometry x="490" y="95" width="85" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="conn-grpc" value="gRPC Server&lt;br&gt;:9091" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#66bb6a;fontSize=10;arcSize=15;" vertex="1" parent="access-group">
          <mxGeometry x="585" y="95" width="85" height="45" as="geometry"/>
        </mxCell>

        <!-- Connect è¯¦æƒ… -->
        <mxCell id="conn-detail" value="&lt;b&gt;è¿žæŽ¥ç®¡ç†&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#555'&gt;ConnectionManager&lt;br&gt;Client (è¯»å†™å¾ªçŽ¯)&lt;br&gt;å¿ƒè·³æ£€æµ‹ / ä¼˜é›…æ–­çº¿&lt;br&gt;Ping-Pong ä¿æ´»&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#66bb6a;fontSize=10;arcSize=10;" vertex="1" parent="access-group">
          <mxGeometry x="700" y="40" width="150" height="95" as="geometry"/>
        </mxCell>

        <!-- ==================== ä¸šåŠ¡æœåŠ¡å±‚ ==================== -->
        <mxCell id="biz-group" value="ä¸šåŠ¡æœåŠ¡å±‚ (Business Services)" style="swimlane;startSize=28;fillColor=#fce4ec;strokeColor=#c62828;fontStyle=1;fontSize=13;fontColor=#b71c1c;rounded=1;arcSize=8;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="430" width="940" height="240" as="geometry"/>
        </mxCell>

        <!-- User Service -->
        <mxCell id="user-svc" value="&lt;b&gt;User ç”¨æˆ·æœåŠ¡&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px;color:#555'&gt;apps/user  |  gRPC :9090&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#3f51b5;fontSize=12;shadow=1;arcSize=12;" vertex="1" parent="biz-group">
          <mxGeometry x="30" y="35" width="420" height="45" as="geometry"/>
        </mxCell>

        <!-- User åˆ†å±‚ -->
        <mxCell id="user-handler" value="&lt;b&gt;Handler å±‚&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:8px'&gt;AuthHandler&lt;br&gt;UserHandler&lt;br&gt;FriendHandler&lt;br&gt;BlacklistHandler&lt;br&gt;DeviceHandler&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#7986cb;fontSize=10;arcSize=10;" vertex="1" parent="biz-group">
          <mxGeometry x="30" y="90" width="130" height="105" as="geometry"/>
        </mxCell>
        <mxCell id="user-service" value="&lt;b&gt;Service å±‚&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:8px'&gt;AuthService&lt;br&gt;UserService&lt;br&gt;FriendService&lt;br&gt;BlacklistService&lt;br&gt;DeviceService&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#7986cb;fontSize=10;arcSize=10;" vertex="1" parent="biz-group">
          <mxGeometry x="175" y="90" width="130" height="105" as="geometry"/>
        </mxCell>
        <mxCell id="user-repo" value="&lt;b&gt;Repository å±‚&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:8px'&gt;AuthRepository&lt;br&gt;UserRepository&lt;br&gt;FriendRepository&lt;br&gt;ApplyRepository&lt;br&gt;BlacklistRepository&lt;br&gt;DeviceRepository&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#7986cb;fontSize=10;arcSize=10;" vertex="1" parent="biz-group">
          <mxGeometry x="320" y="90" width="130" height="105" as="geometry"/>
        </mxCell>

        <!-- Handler â†’ Service â†’ Repository arrows -->
        <mxCell id="h2s" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#7986cb;strokeWidth=1.5;endArrow=block;endFill=1;" edge="1" parent="biz-group" source="user-handler" target="user-service">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="s2r" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#7986cb;strokeWidth=1.5;endArrow=block;endFill=1;" edge="1" parent="biz-group" source="user-service" target="user-repo">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Msg Service (Planned) -->
        <mxCell id="msg-svc" value="&lt;b&gt;Msg æ¶ˆæ¯æœåŠ¡&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px;color:#999'&gt;apps/msg  |  gRPC + Kafka&lt;br&gt;(è§„åˆ’ä¸­ ðŸš§)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#9c27b0;fontSize=12;shadow=1;arcSize=12;dashed=1;dashPattern=8 4;" vertex="1" parent="biz-group">
          <mxGeometry x="530" y="35" width="380" height="45" as="geometry"/>
        </mxCell>
        <mxCell id="msg-detail" value="&lt;font style='font-size:9px;color:#777'&gt;&lt;b&gt;è®¡åˆ’åŠŸèƒ½&lt;/b&gt;&lt;br&gt;æ¶ˆæ¯è½åœ° (MongoDB/MySQL)&lt;br&gt;æ¶ˆæ¯è·¯ç”± (å•èŠ/ç¾¤èŠæŠ•é€’)&lt;br&gt;å†™æ‰©æ•£/è¯»æ‰©æ•£ç­–ç•¥&lt;br&gt;æœªè¯»è®¡æ•° / å›žæ‰§&lt;br&gt;Kafka æ¶ˆè´¹ â†’ Connect æŽ¨é€&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#ce93d8;fontSize=10;arcSize=10;dashed=1;dashPattern=8 4;" vertex="1" parent="biz-group">
          <mxGeometry x="530" y="90" width="190" height="105" as="geometry"/>
        </mxCell>

        <!-- Proto å®šä¹‰ -->
        <mxCell id="proto-box" value="&lt;b&gt;Proto å®šä¹‰&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:8px;color:#555'&gt;proto/user/ (5 ä¸ª .proto)&lt;br&gt;proto/connect/ (1 ä¸ª .proto)&lt;br&gt;proto/msg/ (2 ä¸ª .proto)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#bdbdbd;fontSize=10;arcSize=10;" vertex="1" parent="biz-group">
          <mxGeometry x="750" y="90" width="160" height="75" as="geometry"/>
        </mxCell>

        <!-- ==================== åŸºç¡€è®¾æ–½å±‚ ==================== -->
        <mxCell id="infra-group" value="åŸºç¡€è®¾æ–½å±‚ (Infrastructure)" style="swimlane;startSize=28;fillColor=#efebe9;strokeColor=#795548;fontStyle=1;fontSize=13;fontColor=#4e342e;rounded=1;arcSize=8;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="730" width="940" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="mysql-db" value="&lt;b&gt;MySQL 8.0&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;:3306&lt;br&gt;ç”¨æˆ·/å¥½å‹/é»‘åå•&lt;br&gt;è®¾å¤‡/ç”³è¯·/ä¼šè¯&lt;/font&gt;" style="shape=cylinder3;size=12;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ef6c00;fontSize=10;shadow=1;arcSize=10;" vertex="1" parent="infra-group">
          <mxGeometry x="40" y="35" width="140" height="75" as="geometry"/>
        </mxCell>
        <mxCell id="redis-db" value="&lt;b&gt;Redis 7.2&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;:6379&lt;br&gt;çƒ­ç¼“å­˜ / Token&lt;br&gt;é™æµ / è®¾å¤‡æ´»è·ƒ&lt;/font&gt;" style="shape=cylinder3;size=12;whiteSpace=wrap;html=1;fillColor=#ffebee;strokeColor=#e53935;fontSize=10;shadow=1;arcSize=10;" vertex="1" parent="infra-group">
          <mxGeometry x="230" y="35" width="140" height="75" as="geometry"/>
        </mxCell>
        <mxCell id="kafka-mq" value="&lt;b&gt;Kafka (KRaft)&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;:9092&lt;br&gt;Redisé‡è¯•é˜Ÿåˆ—&lt;br&gt;æ¶ˆæ¯å¼‚æ­¥æŠ•é€’&lt;/font&gt;" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#00897b;fontSize=10;shadow=1;size=12;" vertex="1" parent="infra-group">
          <mxGeometry x="430" y="38" width="160" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="minio-store" value="&lt;b&gt;MinIO&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;:9000 / :9001&lt;br&gt;å¤´åƒ / å›¾ç‰‡ / æ–‡ä»¶&lt;br&gt;é¢„ç­¾å URL&lt;/font&gt;" style="shape=cylinder3;size=12;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#2e7d32;fontSize=10;shadow=1;arcSize=10;" vertex="1" parent="infra-group">
          <mxGeometry x="640" y="35" width="140" height="75" as="geometry"/>
        </mxCell>

        <!-- ==================== å…±äº« Pkg å±‚ ==================== -->
        <mxCell id="pkg-group" value="å…±äº«å·¥å…·å±‚ (pkg/)" style="swimlane;startSize=28;fillColor=#f3e5f5;strokeColor=#7b1fa2;fontStyle=1;fontSize=13;fontColor=#4a148c;rounded=1;arcSize=8;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="905" width="940" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="pkg-items" value="&lt;font style='font-size:10px'&gt;&lt;b&gt;grpcx&lt;/b&gt; (æ‹¦æˆªå™¨/æŒ‡æ ‡)  |  &lt;b&gt;kafka&lt;/b&gt; (ç”Ÿäº§/æ¶ˆè´¹)  |  &lt;b&gt;mysql&lt;/b&gt;  |  &lt;b&gt;redis&lt;/b&gt;  |  &lt;b&gt;minio&lt;/b&gt;  |  &lt;b&gt;logger&lt;/b&gt; (Zap)  |  &lt;b&gt;async&lt;/b&gt; (åç¨‹æ± )  |  &lt;b&gt;ctxmeta&lt;/b&gt;  |  &lt;b&gt;util&lt;/b&gt; (é›ªèŠ±/é‚®ä»¶/JWT)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#ce93d8;fontSize=10;arcSize=10;" vertex="1" parent="pkg-group">
          <mxGeometry x="30" y="35" width="880" height="35" as="geometry"/>
        </mxCell>

        <!-- ==================== æ•°æ®æ¨¡åž‹å±‚ ==================== -->
        <mxCell id="model-box" value="&lt;b&gt;æ•°æ®æ¨¡åž‹ (model/)&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;UserInfo | UserRelation | ApplyRequest&lt;br&gt;DeviceSession | Conversation | Message&lt;br&gt;GroupInfo | GroupMember&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#bdbdbd;fontSize=10;arcSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="60" y="750" width="180" height="85" as="geometry"/>
        </mxCell>

        <!-- ==================== è¿žæŽ¥çº¿ ==================== -->

        <!-- å®¢æˆ·ç«¯ â†’ Gateway (HTTP) -->
        <mxCell id="e-client-gw" value="HTTP REST" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#d6b656;strokeWidth=2;endArrow=block;endFill=1;fontSize=10;fontColor=#bf360c;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="client-group" target="gateway">
          <mxGeometry x="0.2" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="500" y="195"/>
              <mxPoint x="500" y="255"/>
              <mxPoint x="400" y="255"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- å®¢æˆ·ç«¯ â†’ Connect (WebSocket) -->
        <mxCell id="e-client-conn" value="WebSocket é•¿è¿žæŽ¥" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#43a047;strokeWidth=2;endArrow=block;endFill=1;fontSize=10;fontColor=#2e7d32;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="client-group" target="connect">
          <mxGeometry x="0.2" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="900" y="195"/>
              <mxPoint x="900" y="255"/>
              <mxPoint x="860" y="255"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Gateway â†’ User Service (gRPC) -->
        <mxCell id="e-gw-user" value="gRPC è°ƒç”¨" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#3f51b5;strokeWidth=2;endArrow=block;endFill=1;fontSize=10;fontColor=#283593;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="gateway" target="user-svc">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="400" y="400"/>
              <mxPoint x="520" y="400"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Msg Service â†’ Kafka (Consume) -->
        <mxCell id="e-kafka-msg" value="Kafka Consume" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#00897b;strokeWidth=1.5;endArrow=block;endFill=1;dashed=1;dashPattern=8 4;fontSize=9;fontColor=#00695c;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="kafka-mq" target="msg-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="990" y="710"/>
              <mxPoint x="990" y="465"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Msg Service â†’ Connect (gRPC Push) -->
        <mxCell id="e-msg-conn" value="gRPC Push" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#9c27b0;strokeWidth=1.5;endArrow=block;endFill=1;dashed=1;dashPattern=8 4;fontSize=9;fontColor=#7b1fa2;labelBackgroundColor=#ffffff;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="msg-svc" target="connect">
          <mxGeometry x="0.3" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="1000" y="410"/>
              <mxPoint x="860" y="410"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- User Service â†’ MySQL -->
        <mxCell id="e-user-mysql" value="è¯»å†™" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#ef6c00;strokeWidth=1.5;endArrow=block;endFill=1;fontSize=9;fontColor=#e65100;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="user-repo" target="mysql-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="665" y="700"/>
              <mxPoint x="390" y="700"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- User Service â†’ Redis -->
        <mxCell id="e-user-redis" value="ç¼“å­˜ / Token" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e53935;strokeWidth=1.5;endArrow=block;endFill=1;fontSize=9;fontColor=#c62828;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="user-repo" target="redis-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- User Service â†’ Kafka (Produce) -->
        <mxCell id="e-user-kafka" value="Redisé‡è¯•" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#00897b;strokeWidth=1.5;endArrow=block;endFill=1;fontSize=9;fontColor=#00695c;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="user-svc" target="kafka-mq">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="520" y="700"/>
              <mxPoint x="780" y="700"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Connect â†’ Redis (è®¾å¤‡æ´»è·ƒ) -->
        <mxCell id="e-conn-redis" value="è®¾å¤‡æ´»è·ƒ/é‰´æƒ" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e53935;strokeWidth=1.5;endArrow=block;endFill=1;fontSize=9;fontColor=#c62828;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="connect" target="redis-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="860" y="395"/>
              <mxPoint x="1230" y="395"/>
              <mxPoint x="1230" y="780"/>
              <mxPoint x="580" y="780"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Gateway â†’ MinIO -->
        <mxCell id="e-gw-minio" value="æ–‡ä»¶ä¸Šä¼ " style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#2e7d32;strokeWidth=1.5;endArrow=block;endFill=1;fontSize=9;fontColor=#1b5e20;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="gateway" target="minio-store">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="310" y="395"/>
              <mxPoint x="310" y="690"/>
              <mxPoint x="990" y="690"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Gateway â†’ Redis (é™æµ/é»‘åå•) -->
        <mxCell id="e-gw-redis" value="é™æµ/é»‘åå•" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e53935;strokeWidth=1.5;endArrow=block;endFill=1;fontSize=9;fontColor=#c62828;labelBackgroundColor=#ffffff;" edge="1" parent="1" source="gateway" target="redis-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="370" y="400"/>
              <mxPoint x="280" y="400"/>
              <mxPoint x="280" y="780"/>
              <mxPoint x="580" y="780"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ==================== æ¶ˆæ¯æµç¨‹æ ‡æ³¨ ==================== -->
        <mxCell id="flow-label" value="&lt;b&gt;ðŸ“© æ¶ˆæ¯å‘é€æµç¨‹&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;â‘  Client â†’ Gateway (POST /send)&lt;br&gt;â‘¡ Gateway â†’ Kafka (Produce)&lt;br&gt;â‘¢ Gateway â†’ Client (Ack 200 OK)&lt;br&gt;â‘£ Kafka â†’ Msg (Consume)&lt;br&gt;â‘¤ Msg â†’ Redis &amp;amp; DB (å­˜å‚¨)&lt;br&gt;â‘¥ Msg â†’ Connect (gRPC Push)&lt;br&gt;â‘¦ Connect â†’ Client (WebSocket æŽ¨é€)&lt;/font&gt;" style="shape=note;size=15;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#ff8f00;fontSize=10;align=left;spacingLeft=8;shadow=1;arcSize=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="440" width="195" height="160" as="geometry"/>
        </mxCell>

        <!-- Connect RPC èƒ½åŠ›æ ‡æ³¨ -->
        <mxCell id="rpc-label" value="&lt;b&gt;ðŸ”Œ Connect gRPC èƒ½åŠ›&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;â€¢ PushToDevice å•æŽ¨&lt;br&gt;â€¢ PushToUser å…¨è®¾å¤‡å¹¿æ’­&lt;br&gt;â€¢ BroadcastToUsers æ‰¹é‡æŽ¨&lt;br&gt;â€¢ KickConnection è¸¢çº¿&lt;br&gt;â€¢ GetOnlineStatus åœ¨çº¿æŸ¥è¯¢&lt;br&gt;â€¢ BatchGetOnlineStatus æ‰¹é‡æŸ¥&lt;/font&gt;" style="shape=note;size=15;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#43a047;fontSize=10;align=left;spacingLeft=8;shadow=1;arcSize=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="230" width="195" height="140" as="geometry"/>
        </mxCell>

        <!-- Docker æ ‡æ³¨ -->
        <mxCell id="docker-label" value="&lt;b&gt;ðŸ³ Docker Compose&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;chat-network (bridge)&lt;br&gt;å¥åº·æ£€æŸ¥ + ä¾èµ–ç¼–æŽ’&lt;br&gt;Prometheus ç›‘æŽ§&lt;/font&gt;" style="shape=note;size=15;whiteSpace=wrap;html=1;fillColor=#efebe9;strokeColor=#795548;fontSize=10;align=left;spacingLeft=8;shadow=1;arcSize=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="630" width="180" height="80" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
